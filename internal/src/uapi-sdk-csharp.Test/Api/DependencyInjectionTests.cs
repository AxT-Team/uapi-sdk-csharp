/*
 * UAPI
 *
 * UAPI 官方接口文档
 *
 * The version of the OpenAPI document: 1.0.0
 * Generated by: https://github.com/openapitools/openapi-generator.git
 */

using System;
using Microsoft.Extensions.Hosting;
using Microsoft.Extensions.DependencyInjection;
using System.Collections.Generic;
using System.Security.Cryptography;
using uapi-sdk-csharp.Client;
using uapi-sdk-csharp.Api;
using uapi-sdk-csharp.Extensions;
using Xunit;

namespace uapi-sdk-csharp.Test.Api
{
    /// <summary>
    ///  Tests the dependency injection.
    /// </summary>
    public class DependencyInjectionTest
    {
        private readonly IHost _hostUsingConfigureWithoutAClient =
            Host.CreateDefaultBuilder([]).ConfigureApi((context, services, options) =>
            {

            })
            .Build();

        private readonly IHost _hostUsingConfigureWithAClient =
            Host.CreateDefaultBuilder([]).ConfigureApi((context, services, options) =>
            {

                options.AddApiHttpClients(client => client.BaseAddress = new Uri(ClientUtils.BASE_ADDRESS));
            })
            .Build();

        private readonly IHost _hostUsingAddWithoutAClient =
            Host.CreateDefaultBuilder([]).ConfigureServices((host, services) =>
            {
                services.AddApi(options =>
                {

                });
            })
            .Build();

        private readonly IHost _hostUsingAddWithAClient =
            Host.CreateDefaultBuilder([]).ConfigureServices((host, services) =>
            {
                services.AddApi(options =>
                {

                    options.AddApiHttpClients(client => client.BaseAddress = new Uri(ClientUtils.BASE_ADDRESS));
                });
            })
            .Build();

        /// <summary>
        /// Test dependency injection when using the configure method
        /// </summary>
        [Fact]
        public void ConfigureApiWithAClientTest()
        {
            var defaultApi = _hostUsingConfigureWithAClient.Services.GetRequiredService<IDefaultApi>();
            Assert.True(defaultApi.HttpClient.BaseAddress != null);

            var clipzyApi = _hostUsingConfigureWithAClient.Services.GetRequiredService<IClipzyApi>();
            Assert.True(clipzyApi.HttpClient.BaseAddress != null);

            var convertApi = _hostUsingConfigureWithAClient.Services.GetRequiredService<IConvertApi>();
            Assert.True(convertApi.HttpClient.BaseAddress != null);

            var dailyApi = _hostUsingConfigureWithAClient.Services.GetRequiredService<IDailyApi>();
            Assert.True(dailyApi.HttpClient.BaseAddress != null);

            var gameApi = _hostUsingConfigureWithAClient.Services.GetRequiredService<IGameApi>();
            Assert.True(gameApi.HttpClient.BaseAddress != null);

            var imageApi = _hostUsingConfigureWithAClient.Services.GetRequiredService<IImageApi>();
            Assert.True(imageApi.HttpClient.BaseAddress != null);

            var miscApi = _hostUsingConfigureWithAClient.Services.GetRequiredService<IMiscApi>();
            Assert.True(miscApi.HttpClient.BaseAddress != null);

            var networkApi = _hostUsingConfigureWithAClient.Services.GetRequiredService<INetworkApi>();
            Assert.True(networkApi.HttpClient.BaseAddress != null);

            var poemApi = _hostUsingConfigureWithAClient.Services.GetRequiredService<IPoemApi>();
            Assert.True(poemApi.HttpClient.BaseAddress != null);

            var randomApi = _hostUsingConfigureWithAClient.Services.GetRequiredService<IRandomApi>();
            Assert.True(randomApi.HttpClient.BaseAddress != null);

            var socialApi = _hostUsingConfigureWithAClient.Services.GetRequiredService<ISocialApi>();
            Assert.True(socialApi.HttpClient.BaseAddress != null);

            var statusApi = _hostUsingConfigureWithAClient.Services.GetRequiredService<IStatusApi>();
            Assert.True(statusApi.HttpClient.BaseAddress != null);

            var textApi = _hostUsingConfigureWithAClient.Services.GetRequiredService<ITextApi>();
            Assert.True(textApi.HttpClient.BaseAddress != null);

            var translateApi = _hostUsingConfigureWithAClient.Services.GetRequiredService<ITranslateApi>();
            Assert.True(translateApi.HttpClient.BaseAddress != null);

            var webParseApi = _hostUsingConfigureWithAClient.Services.GetRequiredService<IWebParseApi>();
            Assert.True(webParseApi.HttpClient.BaseAddress != null);
        }

        /// <summary>
        /// Test dependency injection when using the configure method
        /// </summary>
        [Fact]
        public void ConfigureApiWithoutAClientTest()
        {
            var defaultApi = _hostUsingConfigureWithoutAClient.Services.GetRequiredService<IDefaultApi>();
            Assert.True(defaultApi.HttpClient.BaseAddress != null);

            var clipzyApi = _hostUsingConfigureWithoutAClient.Services.GetRequiredService<IClipzyApi>();
            Assert.True(clipzyApi.HttpClient.BaseAddress != null);

            var convertApi = _hostUsingConfigureWithoutAClient.Services.GetRequiredService<IConvertApi>();
            Assert.True(convertApi.HttpClient.BaseAddress != null);

            var dailyApi = _hostUsingConfigureWithoutAClient.Services.GetRequiredService<IDailyApi>();
            Assert.True(dailyApi.HttpClient.BaseAddress != null);

            var gameApi = _hostUsingConfigureWithoutAClient.Services.GetRequiredService<IGameApi>();
            Assert.True(gameApi.HttpClient.BaseAddress != null);

            var imageApi = _hostUsingConfigureWithoutAClient.Services.GetRequiredService<IImageApi>();
            Assert.True(imageApi.HttpClient.BaseAddress != null);

            var miscApi = _hostUsingConfigureWithoutAClient.Services.GetRequiredService<IMiscApi>();
            Assert.True(miscApi.HttpClient.BaseAddress != null);

            var networkApi = _hostUsingConfigureWithoutAClient.Services.GetRequiredService<INetworkApi>();
            Assert.True(networkApi.HttpClient.BaseAddress != null);

            var poemApi = _hostUsingConfigureWithoutAClient.Services.GetRequiredService<IPoemApi>();
            Assert.True(poemApi.HttpClient.BaseAddress != null);

            var randomApi = _hostUsingConfigureWithoutAClient.Services.GetRequiredService<IRandomApi>();
            Assert.True(randomApi.HttpClient.BaseAddress != null);

            var socialApi = _hostUsingConfigureWithoutAClient.Services.GetRequiredService<ISocialApi>();
            Assert.True(socialApi.HttpClient.BaseAddress != null);

            var statusApi = _hostUsingConfigureWithoutAClient.Services.GetRequiredService<IStatusApi>();
            Assert.True(statusApi.HttpClient.BaseAddress != null);

            var textApi = _hostUsingConfigureWithoutAClient.Services.GetRequiredService<ITextApi>();
            Assert.True(textApi.HttpClient.BaseAddress != null);

            var translateApi = _hostUsingConfigureWithoutAClient.Services.GetRequiredService<ITranslateApi>();
            Assert.True(translateApi.HttpClient.BaseAddress != null);

            var webParseApi = _hostUsingConfigureWithoutAClient.Services.GetRequiredService<IWebParseApi>();
            Assert.True(webParseApi.HttpClient.BaseAddress != null);
        }

        /// <summary>
        /// Test dependency injection when using the add method
        /// </summary>
        [Fact]
        public void AddApiWithAClientTest()
        {
            var defaultApi = _hostUsingAddWithAClient.Services.GetRequiredService<IDefaultApi>();
            Assert.True(defaultApi.HttpClient.BaseAddress != null);
            
            var clipzyApi = _hostUsingAddWithAClient.Services.GetRequiredService<IClipzyApi>();
            Assert.True(clipzyApi.HttpClient.BaseAddress != null);
            
            var convertApi = _hostUsingAddWithAClient.Services.GetRequiredService<IConvertApi>();
            Assert.True(convertApi.HttpClient.BaseAddress != null);
            
            var dailyApi = _hostUsingAddWithAClient.Services.GetRequiredService<IDailyApi>();
            Assert.True(dailyApi.HttpClient.BaseAddress != null);
            
            var gameApi = _hostUsingAddWithAClient.Services.GetRequiredService<IGameApi>();
            Assert.True(gameApi.HttpClient.BaseAddress != null);
            
            var imageApi = _hostUsingAddWithAClient.Services.GetRequiredService<IImageApi>();
            Assert.True(imageApi.HttpClient.BaseAddress != null);
            
            var miscApi = _hostUsingAddWithAClient.Services.GetRequiredService<IMiscApi>();
            Assert.True(miscApi.HttpClient.BaseAddress != null);
            
            var networkApi = _hostUsingAddWithAClient.Services.GetRequiredService<INetworkApi>();
            Assert.True(networkApi.HttpClient.BaseAddress != null);
            
            var poemApi = _hostUsingAddWithAClient.Services.GetRequiredService<IPoemApi>();
            Assert.True(poemApi.HttpClient.BaseAddress != null);
            
            var randomApi = _hostUsingAddWithAClient.Services.GetRequiredService<IRandomApi>();
            Assert.True(randomApi.HttpClient.BaseAddress != null);
            
            var socialApi = _hostUsingAddWithAClient.Services.GetRequiredService<ISocialApi>();
            Assert.True(socialApi.HttpClient.BaseAddress != null);
            
            var statusApi = _hostUsingAddWithAClient.Services.GetRequiredService<IStatusApi>();
            Assert.True(statusApi.HttpClient.BaseAddress != null);
            
            var textApi = _hostUsingAddWithAClient.Services.GetRequiredService<ITextApi>();
            Assert.True(textApi.HttpClient.BaseAddress != null);
            
            var translateApi = _hostUsingAddWithAClient.Services.GetRequiredService<ITranslateApi>();
            Assert.True(translateApi.HttpClient.BaseAddress != null);
            
            var webParseApi = _hostUsingAddWithAClient.Services.GetRequiredService<IWebParseApi>();
            Assert.True(webParseApi.HttpClient.BaseAddress != null);
        }

        /// <summary>
        /// Test dependency injection when using the add method
        /// </summary>
        [Fact]
        public void AddApiWithoutAClientTest()
        {
            var defaultApi = _hostUsingAddWithoutAClient.Services.GetRequiredService<IDefaultApi>();
            Assert.True(defaultApi.HttpClient.BaseAddress != null);

            var clipzyApi = _hostUsingAddWithoutAClient.Services.GetRequiredService<IClipzyApi>();
            Assert.True(clipzyApi.HttpClient.BaseAddress != null);

            var convertApi = _hostUsingAddWithoutAClient.Services.GetRequiredService<IConvertApi>();
            Assert.True(convertApi.HttpClient.BaseAddress != null);

            var dailyApi = _hostUsingAddWithoutAClient.Services.GetRequiredService<IDailyApi>();
            Assert.True(dailyApi.HttpClient.BaseAddress != null);

            var gameApi = _hostUsingAddWithoutAClient.Services.GetRequiredService<IGameApi>();
            Assert.True(gameApi.HttpClient.BaseAddress != null);

            var imageApi = _hostUsingAddWithoutAClient.Services.GetRequiredService<IImageApi>();
            Assert.True(imageApi.HttpClient.BaseAddress != null);

            var miscApi = _hostUsingAddWithoutAClient.Services.GetRequiredService<IMiscApi>();
            Assert.True(miscApi.HttpClient.BaseAddress != null);

            var networkApi = _hostUsingAddWithoutAClient.Services.GetRequiredService<INetworkApi>();
            Assert.True(networkApi.HttpClient.BaseAddress != null);

            var poemApi = _hostUsingAddWithoutAClient.Services.GetRequiredService<IPoemApi>();
            Assert.True(poemApi.HttpClient.BaseAddress != null);

            var randomApi = _hostUsingAddWithoutAClient.Services.GetRequiredService<IRandomApi>();
            Assert.True(randomApi.HttpClient.BaseAddress != null);

            var socialApi = _hostUsingAddWithoutAClient.Services.GetRequiredService<ISocialApi>();
            Assert.True(socialApi.HttpClient.BaseAddress != null);

            var statusApi = _hostUsingAddWithoutAClient.Services.GetRequiredService<IStatusApi>();
            Assert.True(statusApi.HttpClient.BaseAddress != null);

            var textApi = _hostUsingAddWithoutAClient.Services.GetRequiredService<ITextApi>();
            Assert.True(textApi.HttpClient.BaseAddress != null);

            var translateApi = _hostUsingAddWithoutAClient.Services.GetRequiredService<ITranslateApi>();
            Assert.True(translateApi.HttpClient.BaseAddress != null);

            var webParseApi = _hostUsingAddWithoutAClient.Services.GetRequiredService<IWebParseApi>();
            Assert.True(webParseApi.HttpClient.BaseAddress != null);
        }
    }
}
